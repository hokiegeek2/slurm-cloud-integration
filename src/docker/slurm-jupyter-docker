FROM debian

RUN DEBIAN_FRONTEND=noninteractive 

CMD ["/bin/bash"]
    
RUN apt update -y && apt install curl procps munge vim build-essential git wget \
    sudo software-properties-common mariadb-server -y

RUN apt install python3-pip -y 

RUN useradd -m admin -s /usr/bin/bash -d /home/admin \
    && echo "admin:admin" | chpasswd && adduser admin sudo \
    && echo "admin     ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

RUN apt install slurm-client -y

RUN apt-get update && apt install nodejs -y 
RUN apt-get update && apt install npm  -y 
RUN npm install -g configurable-http-proxy

RUN pip3 install jupyterlab==2.1.2 && pip3 install jupyterlab_slurm
RUN jupyter labextension install jupyterlab-slurm

ADD src/scripts/start-slurm-jupyter.sh /tmp/start-slurm-jupyter.sh

EXPOSE 8888

WORKDIR /tmp

ENTRYPOINT sh ./start-slurm-jupyter.sh
